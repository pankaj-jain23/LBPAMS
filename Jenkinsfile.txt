pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                git branch: 'main',
                    url: 'https://github.com/pankaj-jain23/LBPAMS.git',
                    credentialsId: 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJsOkNK+PNfxziz/RVUye7nUxVFNkug8IkMIDRJsUZ+u serviceplus.pb@gmail.com'
            }
        }
        
        stage('Build') {
            steps {
                echo 'Building the project...'
                // Add build commands here (mvn, npm, dotnet etc.)
            }
        }
        stage('Approval Required')
		{
            steps {
                script {
                    // Email to approver(s) using their Jenkins account ID
                    emailext(
                        subject: "Approval Needed for Build #${env.BUILD_NUMBER}",
                        body: """Hello Approver,<br><br>
                        Build #${env.BUILD_NUMBER} is waiting for your approval in Jenkins.<br>
                        Please <a href="${env.BUILD_URL}">click here</a> to approve/reject.<br><br>
                        Regards,<br>Jenkins""",
                        to: "lbpams-ap1"  // Jenkins user account -> auto fetch email
                    )

                    // UI-based approval (visible in Jenkins dashboard)
                    input(
                        message: 'Build approval required by approver',
                        ok: 'Approve',
                        submitter: 'lbpams-ap1'
                    )
                }
            }
        }
        stage('Test') {
            steps {
                echo 'Running tests...'
                // Add test commands here
            }
        }
        
        stage('Deploy') {
            steps {
                echo 'Deploying...'
                // Add deployment commands here
            }
        }
    }
}
